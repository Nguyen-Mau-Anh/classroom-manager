# Common Orchestrate Configuration
# =================================
# Shared settings used by all orchestration layers (Layer 0, 1, 2)
#
# This file is auto-copied to docs/orchestrate.config.yaml on first run.
# Customize the copy in docs/ folder for your project.

# Story file locations to check (in order)
# Used by all layers when looking for story files
story_locations:
  - "state/stories/${story_id}.md"
  - "docs/stories/${story_id}.md"
  - "docs/sprint-artifacts/${story_id}.md"

# Git settings (used by Layer 1 and Layer 2)
git:
  base_branch: "main"
  branch_prefix: "story"
  auto_commit: true
  commit_message_template: |
    {story_id}: {summary}

    Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>

# PR settings (used by Layer 2)
pr:
  auto_merge: true
  merge_method: "squash"  # squash, merge, rebase
  delete_branch_after_merge: true
  require_ci_pass: true
  ci_timeout: 7200  # 2 hours max wait for CI

# Knowledge Base Configuration
# Controls how lessons learned are captured and applied across all layers
knowledge_base:
  enabled: true
  max_lessons_per_stage: null      # Max lessons to show per stage (null = all)
  min_encounter_count: 1           # Minimum times a lesson must be seen to be included

# Default timeouts (seconds) for different operations
# Individual stages can override these in their layer-specific config
timeouts:
  layer_call: 7200        # 2 hours for layer delegation (Layer N â†’ Layer N-1)
  story_creation: 3600    # 1 hour for creating story (Layer 0)
  story_validation: 1800  # 30 min for validating story (Layer 0)
  development: 21600      # 6 hours for dev-story workflow (Layer 1)
  lint_check: 3600        # 1 hour for linting (Layer 1)
  typecheck: 3600         # 1 hour for type checking (Layer 1)
  tests: 3600             # 1 hour for running tests (Layer 1)
  code_review: 3600       # 1 hour for code review (Layer 1)
  pr_creation: 1800       # 30 min for creating PR (Layer 2)
  ci_wait: 7200           # 2 hours for waiting for CI/CD (Layer 2)
  auto_merge: 600         # 10 min for auto-merge (Layer 2)

# Default retry settings
# Individual stages can override these in their layer-specific config
retry:
  max_attempts: 3
  on_failure: "abort"  # abort, continue, fix_and_retry

# Autonomy instructions injected into all prompts across all layers
autonomy_instructions: |
  AUTONOMOUS MODE - NO QUESTIONS.
  Skip all menus, confirmations, and user prompts.
  Execute the task completely and output results only.
  Do not ask follow-up questions.

# Health monitoring (for subprocess spawning)
health_monitoring:
  enabled: true
  activity_timeout: 1200    # 20 minutes without output = likely hung
  health_check_interval: 10  # Check every 10 seconds
  use_cpu_detection: true   # Monitor CPU usage for hung detection
